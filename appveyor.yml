version: 2.0.0.{build}
image: Visual Studio 2017
skip_non_tags: true

dotnet_csproj:
  patch: true
  file: '**\*.csproj'
  version: '{version}'
  package_version: '{version}'
  assembly_version: '{version}'
  file_version: '{version}'
  informational_version: '{version}'

before_build:
- ps: >-
    nuget restore

build:
  project: C:\projects\dotfeather\dotfeather\dotfeather.csproj
  publish_nuget: true

configuration: Release

after_build:
  - nuget pack -Prop Configuration=Release DotFeather -OutputDirectory DotFeather/bin/Release/

artifacts:
  - path: '**\*.nupkg'
    name: DotFeather

deploy:
- provider: NuGet
  api_key:
    # Use encrypt tool
    # https://ci.appveyor.com/tools/encrypt
    secure: nknIyuf45/JACWB2OAWD32oU6HlW4AkkiI974KwKPPkMh3dRHJXsVQVbN/iIUjg/
  artifact: /.*\.nupkg/
  on:
    appveyor_repo_tag: true
- provider: GitHub
  artifact: /.*\.nupkg/           # upload all NuGet packages to release assets
  draft: false
  prerelease: false
  description: |
    ## 2.0.0 Powerful Renewal Update

    ### 新機能
    - `DFKeyboard` 静的クラスを追加しました。キーボード入力を受け取るために用います
    - `DFMouse` 静的クラスを追加しました。マウス入力を受け取るために用います
    - `VectorInt` 構造体を追加しました。これまでの `Vector` 構造体の整数版であり、`Vector` 構造体に暗黙型変換されます
    - `DotFeather.Router` の機能を統合しました
      - パスをキーとしてシーンを登録できる新たな API を追加しました
      - `Scene.Title` プロパティを追加しました。ウィンドウのタイトルをシーンから取得または設定できます。
    - `Container.IsTrimmable` プロパティを追加しました。コンテナーの占める領域の外にはみ出た描画可能オブジェクトをクリッピングする機能です
    - Random クラスに、ランダムな `VectorInt` 構造体を取得する拡張メソッドを追加
    - `AnimatingSprite` クラスを追加。アニメーションするスプライトを作成できます
    - `AudioPlayer` クラスに、現在の音声再生時間を取得するプロパティを追加しました

    ### API 互換性を破壊する変更
    - `Input` クラスは削除されました。代わりに新しい `DFKeyboard` クラス、 `DFMouse` クラスを使用してください
    - `System.Drawing` 名前空間の `Point`, `Size` 構造体は API で使用しなくなりました。代わりに、新しい `VectorInt` 構造体を用いてください
    - .NET Standard 2.1 に依存するようになりました。C# 8 環境では Null 安全になります
    - System.Drawing.Common に依存していた画像処理ロジックを、 `ImageSharp` に変更
      - `Texture2D` のメンバーのうち、内部的に使用されていたものが、この変更により破壊的変更されています
    - `double` 型を用いていた API が、代わりに `float` 型を用いるようになりました

    ### 仕様変更
    - DotFeather ウィンドウがデフォルトでリサイズできない状態になりました

    ### バグ修正
    - キャプチャーモードの有効状態に関わらず、常にカレントディレクトリに shot フォルダが生成される問題を修正
    - `IEnumerator` をイールド命令として使ったときにコルーチンが想定しない動きをする問題を修正

    ### その他
    - 大幅なリファクタリングを行いました
    - API ドキュメントを英語で書き直しました。ドキュメンテーションのローカライズ作業は先の話になりそうです

    ----

    ### New features
    - Added `DFKeyboard` static class to handle keyboard input
    - Added `DFMouse` static class to handle mouse input
    - Added `VectorInt` structure. This is a integer version of `Vector` structure, and it can be casted implicitly to `Vector` structure
    - Integrated features of `DotFeather.Router`
      - Added new api to register scenes by path
      - Added `Scene.Title` property. You can get or set title of the window from the scene
    - Added `Container.IsTrimmable` property to clip drawables outside container's bounding box
    - Add extension method to Random class to get random `VectorInt` structure
    - Added `AnimatingSprite` class to create animated sprites
    - Added a property to `AudioPlayer` class to get current playback time.

    ### API-compatibility breaking changes
    - The `Input` class has been removed. Use the new `DFKeyboard` class and `DFMouse` class instead
    - The `Point` and` Size` structures in the `System.Drawing` namespace are no longer used by the API. Use the new `VectorInt` structure instead
    - Now depends on .NET Standard 2.1. Null safe in C# 8 environment
    - Changed image processing logic that relied on System.Drawing.Common to `ImageSharp`
      - Some of the members of `Texture2D` that were used internally have been destructively changed
    - APIs that used the `double` type now use the`float` type instead

    ### Changes
    - DotFeather window can no longer be resized by default

    ### Bug fixes
    - Fixed a issue that a shot folder is always created in the current directory regardless of whether capture mode is enabled
    - Fixed a issue that coroutine works unexpectedly when use `IEnumerator` as a yield instruction

    ### Others
    - Refactored very much
    - Rewrote all API documents in English

  auth_token:
    secure: FUlGF4CyRZNM6jaGz2wlmsOIwZt4av2Cxn4lHbi5wU5lim3FixH9ZIhLGDRZftOx
  on:
    APPVEYOR_REPO_TAG: true       # deploy on tag push only
